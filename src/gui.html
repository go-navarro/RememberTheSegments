<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<html>

<head>
    <link rel="stylesheet" href="guiStyling.css">
</head>

<body>
    <div id="divMain">
        <?xml version="1.0" encoding="UTF-8" standalone="no"?>
        <svg id="shapeContainer" width="150mm" height="150mm" viewBox="0 0 150 150" version="1.1"
            xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
            <defs id="defs2" />
            <g id="layer1">
                <path id="segment0" style="stroke-width:0.263733" fill="#cd7f32" type="arc" cx="75" cy="75" rx="60"
                    ry="60" start="4.712389" end="0" arc-type="slice" onmousedown="registerClick(this.id)"
                    onmouseup="resetSegmentColor(this.id)" d="m 75,15 a 60,60 0 0 1 60,60 H 75 Z" />
                <path id="segment1" style="stroke-width:0.263733" fill="#ffbf00" type="arc" cx="75" cy="75" rx="60"
                    ry="60" start="3.1415927" end="4.712389" arc-type="slice" onmousedown="registerClick(this.id)"
                    onmouseup="resetSegmentColor(this.id)"
                    d="M 15,75 A 60,60 0 0 1 32.573594,32.573593 60,60 0 0 1 75,15 v 60 z" />
                <path id="segment2" style="stroke-width:0.263733" fill="#880808" type="arc" cx="75" cy="75" rx="60"
                    ry="60" start="1.5707963" end="3.1415927" arc-type="slice" onmousedown="registerClick(this.id)"
                    onmouseup="resetSegmentColor(this.id)"
                    d="M 75,135 A 60,60 0 0 1 32.573593,117.42641 60,60 0 0 1 15,75 h 60 z" />
                <path id="segment3" style="stroke-width:0.263733" fill="#000000" type="arc" cx="75" cy="75" rx="60"
                    ry="60" start="0" end="1.5707963" arc-type="slice" onmousedown="registerClick(this.id)"
                    onmouseup="resetSegmentColor(this.id)" d="M 135,75 A 60,60 0 0 1 75,135 V 75 Z" />
            </g>
        </svg>
        <button id="buttonNewGame" onclick="viewRandomInt(numBlinks)">New Game</button>
    </div>
</body>
<script type="text/javascript" src="RandomNumberGeneration.js"></script>
<script type="text/javascript" src="GameFunctions.js"></script>
<script>
    var offColor = "#ffffff";
    const segmentInfo = { "segment0": "#cd7f32", "segment1": "#ffbf00", "segment2": "#880808", "segment3": "#000000" };
    const statusColors = { "success": "#7ec850", "failure": "#ff4d4d" };
    const numSegments = Object.keys(segmentInfo).length;

    const numBlinks = 4;
    var userAns = [];
    var correctAns = [];

    function resetSegmentColor(segment) {
        document.getElementById(segment).setAttribute("fill", segmentInfo[segment]);
    }

    function resetSegments() {
        for (segment in segmentInfo) {
            resetSegmentColor(segment, segmentInfo[segment]);
        }
    }

    function registerClick(id) {
        document.getElementById(id).setAttribute("fill", offColor);
        userAns.push(id);

        if (userAns.length === numBlinks) {

            resetSegments();
            if (isGameWon(userAns, correctAns)) {
                userAns = [];
                correctAns = [];
                changeStatus("You win. Play again?", "white", statusColors.success);
            } else {
                userAns = [];
                correctAns = [];
                changeStatus("You lose. Play again?", "white", statusColors.failure);
            }
            disableAllSegments(true);
            document.getElementById("buttonNewGame").disabled = false;
        }
        return id;
    }

    function disableAllSegments(disableYes) {
        for (segment in segmentInfo) {
            if (disableYes) {
                document.getElementById(segment).setAttribute("onmousedown", "");
                document.getElementById(segment).setAttribute("onmouseup", "");
            } else {
                document.getElementById(segment).setAttribute("onmousedown", "registerClick(this.id)");
                document.getElementById(segment).setAttribute("onmouseup", "resetSegmentColor(this.id)");
            }
        }
    }

    function viewRandomInt(seqLength) {
        changeStatus("Memorize the sequence.", "white", "#36454f");

        var button = document.getElementById("buttonNewGame");
        button.disabled = true;
        disableAllSegments(true);

        let increment = 400;
        var blinkDuration = 2 * seqLength + 2;
        for (let i = 1; i < blinkDuration; i++) {
            setTimeout(() => {
                if ((i % 2) === 0) {
                    let rand = randomInt(0, numSegments);
                    let segmentName = Object.keys(segmentInfo)[rand];

                    correctAns.push(segmentName);

                    let chosenSegment = document.getElementById(segmentName);
                    chosenSegment.setAttribute("fill", offColor);
                } else {
                    resetSegments();
                }
            }, i * increment);
        }

        setTimeout(() => {
            resetSegments();
            disableAllSegments(false);
        }, blinkDuration * increment);
    }

    function changeStatus(statusText, statusTextColor, statusBackground) {
        let button = document.getElementById("buttonNewGame");
        button.innerText = statusText;
        button.innerText = statusText;
        button.style.color = statusTextColor;
        button.style.background = statusBackground;
    }

    function isGameWon(correctAns, userAns) {
        return JSON.stringify(correctAns) === JSON.stringify(userAns);
    }

</script>

</html>